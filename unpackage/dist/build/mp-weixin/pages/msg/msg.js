(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/msg/msg"],{"227d":function(t,e,a){"use strict";(function(t){a("66ba");i(a("66fd"));var e=i(a("9da9"));function i(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=a,t(e.default)}).call(this,a("543d")["createPage"])},3967:function(t,e,a){},"3aed":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=s(a("a34a")),n=a("26cb");function s(t){return t&&t.__esModule?t:{default:t}}function o(t,e,a,i,n,s,o){try{var c=t[s](o),u=c.value}catch(r){return void a(r)}c.done?e(u):Promise.resolve(u).then(i,n)}function c(t){return function(){var e=this,a=arguments;return new Promise((function(i,n){var s=t.apply(e,a);function c(t){o(s,i,n,c,u,"next",t)}function u(t){o(s,i,n,c,u,"throw",t)}c(void 0)}))}}function u(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function r(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?u(Object(a),!0).forEach((function(e){l(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function l(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var d=t.getSystemInfoSync(),h=function(){a.e("compoents/home/biu-info").then(function(){return resolve(a("cc19"))}.bind(null,a)).catch(a.oe)},f=function(){a.e("compoents/home/xinxi-cell").then(function(){return resolve(a("fcb7"))}.bind(null,a)).catch(a.oe)},g=function(){a.e("compoents/home/sixin-cell").then(function(){return resolve(a("d9fa"))}.bind(null,a)).catch(a.oe)},p={components:{BiuInfo:h,XinxiCell:f,SixinCell:g},computed:r({},(0,n.mapState)({isLogin:"isLogin"})),data:function(){return{scrollTop:0,searchShow:!1,rstCustomStyle:{border:"1rpx solid #AE9F82",color:"#AE9F82"},colorList:["#363D50","#FFFFFF"],bgColorList:["#EDEDED","#AE9F82"],categroyIndex1:0,categroyList1:[{value:0,name:"全部"},{value:2001,name:"评论"},{value:2002,name:"抱抱"},{value:2003,name:"回复"}],categroyIndex2:0,categroyList2:[{value:0,name:"全部"},{value:1001,name:"公告"},{value:1002,name:"活动"},{value:1003,name:"更新"}],categroyIndex3:0,categroyList3:[{value:0,name:"全部"},{value:3001,name:"申请"},{value:3002,name:"笔友"},{value:3003,name:"寄信"},{value:3004,name:"收信"}],categroyIndex4:0,categroyList4:[{value:2,name:"全部"},{value:0,name:"陌生人"},{value:1,name:"笔友"}],statusIndex1:0,statusIndex2:0,statusIndex3:0,statusIndex4:0,statusList:[{value:2,name:"全部"},{value:1,name:"已读"},{value:0,name:"未读"}],badeg:{offset:[-2,-2]},sticky:{enable:!0},height:44,statusBarHeight:d.statusBarHeight,srcleft:"../../../static/treehole/xinxi/xinxi-tip.png",imgsize:46,currIdx:0,title:"信息",titleList:[{name:"信息",show:!0,icon:"../../../static/treehole/xinxi/xinxi-sixin.png",hasnew:!1},{name:"公告",show:!1,icon:"../../../static/treehole/xinxi/xinxi-gonggao.png",hasnew:!1},{name:"通知",show:!1,icon:"../../../static/treehole/xinxi/xinxi-tongzhi.png",hasnew:!1},{name:"私信",show:!1,icon:"../../../static/treehole/xinxi/xinxi-xinxi.png",hasnew:!1}],message_datalist:[],public:{datalist:[]},notice:{datalist:[]},sixin:{datalist:[]},page1:1,page2:1,page3:1,page4:1,loadStatus0:"loadmore",loadStatus1:"loadmore",loadStatus2:"loadmore",loadStatus3:"loadmore",ismore1:1,ismore2:1,ismore3:1,ismore4:1,lastid1:"",lastid2:"",lastid3:"",lastid4:""}},watch:{currIdx:function(t){switch(t){case 0:0===this.message_datalist.length&&this.handleSearch();break;case 1:0===this.public.datalist.length&&this.handleSearch();break;case 2:0===this.notice.datalist.length&&this.handleSearch();break;case 3:0===this.notice.datalist.length&&this.handleSearch();break;default:break}}},methods:{link2sx:function(e){var a=r(r({},e),{},{friend:e.id,id:e.frient});a.communicate=e.communicateInfo.communicate,t.navigateTo({url:"../../pages/msg/sixin?params="+encodeURIComponent(JSON.stringify(a))})},link2biu:function(e){var a=r(r({},e),{},{friend:e.id,id:e.frient});a.communicate=e.communicateInfo.communicate,t.navigateTo({url:"../user/biu?params="+encodeURIComponent(JSON.stringify(a))})},getBlackList:function(e){var a=this,i="/user/friend/message/users",n={isFriend:e.sub,read:e.read};a.$http.post(i,n).then((function(e){console.info(e);var i=e.data;200===i.code?(console.info("_result.data:5.30:::::",i.data.list),a.sixin.datalist=i.data.list):501===i.code&&setTimeout((function(){t.hideLoading(),a.$store.dispatch("Logout")}),800)})).catch((function(t){var e=t.message;a.$tip.error(e)})).finally((function(){}))},clickevent:function(t){this.title=this.titleList[t].name,this.currIdx=t},fixed:function(){},unfixed:function(){},openSearch:function(){this.searchShow=!0},allReaded:function(e){var a=this,i="/user/message/all/read";this.$http.post(i,{type:e}).then((function(e){501===e.data.code&&setTimeout((function(){t.hideLoading(),a.$store.dispatch("Logout")}),800)})).catch((function(t){})).finally((function(){}))},handleSearch:function(){switch(this.titleList[this.currIdx].hasnew=!1,this.currIdx){case 0:this.allReaded("message"),this.loadData({type:"message",sub:this.categroyList1[this.categroyIndex1].value,read:this.statusList[this.statusIndex1].value,page:this.page1});break;case 1:this.allReaded("public"),this.loadData({type:"public",sub:this.categroyList2[this.categroyIndex2].value,read:this.statusList[this.statusIndex2].value,page:this.page2});break;case 2:this.allReaded("notice"),this.loadData({type:"notice",sub:this.categroyList3[this.categroyIndex3].value,read:this.statusList[this.statusIndex3].value,page:this.page3});break;case 3:this.allReaded("private"),this.getBlackList({sub:this.categroyList4[this.categroyIndex4].value,read:this.statusList[this.statusIndex4].value,page:this.page4});break;default:break}this.searchShow=!1},handleReset:function(){switch(this.currIdx){case 0:this.categroyIndex1=0,this.statusIndex1=0;break;case 1:this.categroyIndex2=0,this.statusIndex2=0;break;case 2:this.categroyIndex3=0,this.statusIndex3=0;break;case 3:this.categroyIndex4=2,this.statusIndex4=0;break;default:break}this.searchShow=!1,this.handleSearch()},check1:function(t){switch(this.currIdx){case 0:this.categroyIndex1=t;break;case 1:this.categroyIndex2=t;break;case 2:this.categroyIndex3=t;break;case 3:this.categroyIndex4=t;break;default:break}},check2:function(t){switch(this.currIdx){case 0:this.statusIndex1=t;break;case 1:this.statusIndex2=t;break;case 2:this.statusIndex3=t;break;case 3:this.statusIndex4=t;break;default:break}},loadData:function(e){t.showLoading({mask:!0,title:"正在加载"});var a=this,i="/user/message/list";e=r(r({},e),{},{size:20}),e.page>1&&("message"===e.type&&(e=r(r({},e),{},{last:a.lastid1})),"public"===e.type&&(e=r(r({},e),{},{last:a.lastid2})),"notice"===e.type&&(e=r(r({},e),{},{last:a.lastid3}))),a.$http.post(i,e).then((function(e){var i=e.data;if(200===i.code)switch(console.info("_result.data:4.25:",i.data),a.currIdx){case 0:a.ismore1=i.data.more,a.lastid1=i.data.last,1===a.page1?(a.message_datalist=[],a.message_datalist=i.data.list):a.message_datalist=a.message_datalist.concat(i.data.list);break;case 1:a.ismore2=i.data.more,a.lastid2=i.data.last,1===a.page2?(a.public.datalist=[],a.public.datalist=i.data.list):a.public.datalist=a.public.datalist.concat(i.data.list);break;case 2:a.ismore3=i.data.more,a.lastid3=i.data.last,1===a.page3?(a.notice.datalist=[],a.notice.datalist=i.data.list):a.notice.datalist=a.notice.datalist.concat(i.data.list);break;default:break}else if(501===i.code)setTimeout((function(){t.hideLoading(),a.$store.dispatch("Logout")}),800);else switch(a.currIdx){case 0:a.message_datalist=[];break;case 1:a.public.datalist=[];break;case 2:a.notice.datalist=[];break;default:break}})).catch((function(t){console.info("err::",t);t.message})).finally((function(){t.hideLoading()}))},hasReaded:function(e){var a=this,i="/user/message/read",n={id:e};a.$http.post(i,n).then((function(e){var i=e.data;console.info(i),501===i.code&&setTimeout((function(){t.hideLoading(),a.$store.dispatch("Logout")}),800),a.getMsgTip()})).catch((function(t){var e=t.message;console.info("error:",e)})).finally((function(){}))},link2detail:function(e){0===e.readStatus&&this.hasReaded(e.id);var a=this;if(0===a.currIdx){var i="/hole/note/info";a.$http.post(i,{id:e.note}).then((function(e){var i=e.data;200===i.code?t.navigateTo({url:"../forest/letter?params="+encodeURIComponent(JSON.stringify(i.data))}):501===i.code&&setTimeout((function(){t.hideLoading(),a.$store.dispatch("Logout")}),800)})).catch((function(t){console.info("err::",t);t.message})).finally((function(){}))}else 1===a.currIdx?t.navigateTo({url:"./msgdetail?params="+encodeURIComponent(JSON.stringify(e))}):3003===e.messageType||3004===e.messageType?(t.setStorageSync("msg_to",2),setTimeout((function(){t.switchTab({url:"../home/home"})}),500)):t.navigateTo({url:"./msgdetail?params="+encodeURIComponent(JSON.stringify(e))})},getMsgTip:function(){var e=this,a="/user/message/tip";e.$http.post(a,{}).then((function(i){var n=i.data;console.info(a,n.data),200===n.code?(n.data.message>0?e.titleList[0].hasnew=!0:e.titleList[0].hasnew=!1,n.data.public>0?e.titleList[1].hasnew=!0:e.titleList[1].hasnew=!1,n.data.notice>0?e.titleList[2].hasnew=!0:e.titleList[2].hasnew=!1,n.data.private>0?e.titleList[3].hasnew=!0:e.titleList[3].hasnew=!1,t.hideTabBarRedDot({index:2})):501===n.code&&setTimeout((function(){t.hideLoading(),e.$store.dispatch("Logout")}),800)})).catch((function(t){console.info("err::",t);t.message})).finally((function(){}))},longtap:function(e){var a=this;t.showModal({title:"提示",content:"是否删除该消息？",success:function(){var n=c(i.default.mark((function n(s){var o,c;return i.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:s.confirm?(o=a,c="/user/message/remove",{id:e.id},o.$http.post(c,{id:e.id}).then((function(e){var a=e.data;200===a.code?(o.page1=1,o.page2=1,o.page3=1,o.getMsgTip(),o.handleSearch()):501===a.code&&setTimeout((function(){t.hideLoading(),o.$store.dispatch("Logout")}),800)})).catch((function(t){t.message;console.info(c,t)})).finally((function(){}))):s.cancel;case 1:case"end":return i.stop()}}),n)})));function s(t){return n.apply(this,arguments)}return s}()})},longtap_sixin:function(e){var a=this;t.showModal({title:"提示",content:"是否删除私信记录？",success:function(){var n=c(i.default.mark((function n(s){var o,c,u;return i.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:s.confirm?(o=a,c="/user/friend/message/remove",u={friend:e.id},o.$http.post(c,u).then((function(e){console.info(e);var a=e.data;200===a.code?(o.page4=1,o.getMsgTip(),o.handleSearch()):501===a.code&&setTimeout((function(){t.hideLoading(),o.$store.dispatch("Logout")}),800)})).catch((function(t){t.message;console.info(c,t)})).finally((function(){}))):s.cancel;case 1:case"end":return i.stop()}}),n)})));function s(t){return n.apply(this,arguments)}return s}()})}},onPullDownRefresh:function(){this.page1=1,this.page2=1,this.page3=1,this.handleSearch(),this.getMsgTip(),setTimeout((function(){t.stopPullDownRefresh()}),1200)},onReachBottom:function(){var t=this;switch(this.currIdx){case 0:1===this.ismore1?(this.page1+=1,this.loadStatus0="loading",setTimeout((function(){t.loadStatus0="loadmore"}),500),this.handleSearch(),this.getMsgTip()):(this.loadStatus0="nomore",this.$u.toast("没有更多了"));break;case 1:1===this.ismore2?(this.page2+=1,this.loadStatus1="loading",setTimeout((function(){t.loadStatus1="loadmore"}),500),this.handleSearch(),this.getMsgTip()):(this.loadStatus1="nomore",this.$u.toast("没有更多了"));break;case 2:1===this.ismore3?(this.page3+=1,this.loadStatus2="loading",setTimeout((function(){t.loadStatus2="loadmore"}),500),this.handleSearch(),this.getMsgTip()):(this.loadStatus2="nomore",this.$u.toast("没有更多了"));break;default:break}},onLoad:function(){this.height=this.height+this.statusBarHeight-1,this.titleList[this.currIdx].hasnew=!1},mounted:function(){},onPageScroll:function(t){this.scrollTop=t.scrollTop},onShow:function(){this.page1=1,this.page2=1,this.page3=1,this.isLogin?(this.getMsgTip(),this.handleSearch()):(this.$u.toast("未登录"),setTimeout((function(){t.switchTab({url:"../home/home"})}),500)),3===this.currIdx&&this.getBlackList({sub:this.categroyList4[this.categroyIndex4].value,read:this.statusList[this.statusIndex4].value})}};e.default=p}).call(this,a("543d")["default"])},5179:function(t,e,a){"use strict";var i=a("3967"),n=a.n(i);n.a},"815c":function(t,e,a){"use strict";a.r(e);var i=a("3aed"),n=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,(function(){return i[t]}))}(s);e["default"]=n.a},"9da9":function(t,e,a){"use strict";a.r(e);var i=a("f775"),n=a("815c");for(var s in n)"default"!==s&&function(t){a.d(e,t,(function(){return n[t]}))}(s);a("5179");var o,c=a("f0c5"),u=Object(c["a"])(n["default"],i["b"],i["c"],!1,null,"cfbb8aa4",null,!1,i["a"],o);e["default"]=u.exports},f775:function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return s})),a.d(e,"a",(function(){return i}));var i={uNavbar:function(){return a.e("uview-ui/components/u-navbar/u-navbar").then(a.bind(null,"2122"))},uSticky:function(){return a.e("uview-ui/components/u-sticky/u-sticky").then(a.bind(null,"8564"))},uImage:function(){return a.e("uview-ui/components/u-image/u-image").then(a.bind(null,"4bb9"))},uBadge:function(){return a.e("uview-ui/components/u-badge/u-badge").then(a.bind(null,"d9d5"))},uDivider:function(){return a.e("uview-ui/components/u-divider/u-divider").then(a.bind(null,"eb1c"))},uLoadmore:function(){return a.e("uview-ui/components/u-loadmore/u-loadmore").then(a.bind(null,"05ad"))},uPopup:function(){return a.e("uview-ui/components/u-popup/u-popup").then(a.bind(null,"5c2c"))},uTag:function(){return a.e("uview-ui/components/u-tag/u-tag").then(a.bind(null,"8281"))},uButton:function(){return a.e("uview-ui/components/u-button/u-button").then(a.bind(null,"5352"))},uBackTop:function(){return a.e("uview-ui/components/u-back-top/u-back-top").then(a.bind(null,"3872"))}},n=function(){var t=this,e=t.$createElement;t._self._c},s=[]}},[["227d","common/runtime","common/vendor"]]]);